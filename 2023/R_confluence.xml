<h2 id="おすすめ教科書">おすすめ教科書<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">おすすめ教科書</ac:parameter></ac:structured-macro></h2>
<ul>
<li><p><a href='https://adv-r.hadley.nz/' title=''>Advanced R</a></p>
<ul>
<li><p>非常に簡潔かつわかりやすく、“プログラミング言語”としてのRを解説</p></li>
<li><p>仕事でデータ分析をする可能性があるのであれば、学生時代に読むことを強くお勧め</p></li>
<li><p>Pythonなどにも共通する解説</p></li>
</ul></li>
<li><p>より一般的な解説書として、 <a href='https://r4ds.had.co.nz/' title=''>R for Data Science</a></p></li>
</ul>
<h2 id="例題">例題<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">例題</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[library(mlr3verse)]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-annotation">
<dl>
<dt>Lines 3,5</dt>
<dd>
objectを複製し、 浅い木も推定したい、、が
</dd>
</dl>
</div>
<div class="cell-output cell-output-stderr">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[Loading required package: mlr3]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[Tree <- lrn("regr.rpart")

ShallowTree <- Tree

ShallowTree$param_set$values$maxdepth <- 2
]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
<h2 id="例題-1">例題<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">例題-1</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[Tree
]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-annotation">
<dl>
<dt>Line 1</dt>
<dd>
“勝手に変わった!!!”
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[<LearnerRegrRpart:regr.rpart>: Regression Tree
* Model: -
* Parameters: xval=0, maxdepth=2
* Packages: mlr3, rpart
* Predict Types:  [response]
* Feature Types: logical, integer, numeric, factor, ordered
* Properties: importance, missings, selected_features, weights]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
</div>
<h2 id="rの基本文法">Rの基本文法<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">rの基本文法</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[a <- 1
]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-annotation">
<dl>
<dt>Line 1</dt>
<dd>
“1をaという名前で保存”
</dd>
</dl>
</div>
</div>
<ul>
<li>正確には、 “メモリ-上のどこか(Location)に保存された1を、aというReference(参照名)で保存”</li>
</ul>
<h2 id="copy">Copy<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">copy</ac:parameter></ac:structured-macro></h2>
<ul>
<li><p>一般に複製(copy)には、複数の意味がある</p></li>
<li><p>参照名の複製とobjectの複製を区別することは、しばしば重要</p>
<ul>
<li>mlr3のようなobject志向では非常に重要</li>
</ul></li>
</ul>
<h2 id="locationとreference-参照名">LocationとReference (参照名)<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">locationとreference-参照名</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[a <- 1

b <- a
]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-annotation">
<dl>
<dt>Line 3</dt>
<dd>
aを複製?
</dd>
</dl>
</div>
</div>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[lobstr::obj_addr(a)

lobstr::obj_addr(b)
]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-annotation">
<dl>
<dt>Line 1</dt>
<dd>
lobstrパッケージを局所的にロード
</dd>
<dt>Line 3</dt>
<dd>
同じobjectに、異なる参照名 (a,b) を付与している”だけ”
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[[1] "0x139df3f58"
[1] "0x139df3f58"]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
</div>
<h2 id="copy-on-modification">Copy on modification<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">copy-on-modification</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[a <- 1

b <- a

b <- b + 1

lobstr::obj_addr(a)

lobstr::obj_addr(b)
]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-annotation">
<dl>
<dt>Line 5</dt>
<dd>
objectに操作を加えると、objectそのものが異なるlocationにコピーされる
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[[1] "0x138a4efe0"
[1] "0x13857ab80"]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
</div>
<h2 id="まとめ">まとめ<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">まとめ</ac:parameter></ac:structured-macro></h2>
<ul>
<li><p>Rのほとんどのpackageにおいて、copy-on-modificationがdefault</p>
<ul>
<li>objectを操作した場合、異なるlocationに複製(deep copy) を自動で行う</li>
</ul></li>
<li><p>プログラムに詳しくなくても、予期せぬ挙動を抑止できる</p>
<ul>
<li>不要なdeep copyが行われてしまい、計算速度が犠牲になる場合も、、、</li>
</ul></li>
<li><p><a href='https://r6.r-lib.org/articles/Introduction.html' title=''>R6 class</a>を採用しているpackage(mlr3など) は例外</p></li>
</ul>
<h2 id="mlr3-objects">mlr3 objects<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">mlr3-objects</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[library(mlr3verse)

Tree <- lrn("regr.rpart")

Tree1 <- Tree

lobstr::obj_addr(Tree)]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-output cell-output-stdout">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[[1] "0x13f543360"]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[lobstr::obj_addr(Tree1)]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-output cell-output-stdout">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[[1] "0x13f543360"]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
</div>
<h2 id="mlr3-objects-1">mlr3 objects<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">mlr3-objects-1</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[Tree <- lrn("regr.rpart")

Tree1 <- Tree

Tree1$param_set$values$maxdepth <- 2

Tree$param_set$values$maxdepth

Tree1$param_set$values$maxdepth
]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-annotation">
<dl>
<dt>Line 5</dt>
<dd>
object自体は複製されない!!!
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[[1] 2
[1] 2]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
</div>
<h2 id="mlr3-objects-2">mlr3 objects<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">mlr3-objects-2</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[lobstr::obj_addr(Tree)]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-output cell-output-stdout">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[[1] "0x148172000"]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[lobstr::obj_addr(Tree1)]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-output cell-output-stdout">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[[1] "0x148172000"]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
</div>
<ul>
<li>object自体は複製されない!!!</li>
</ul>
<h2 id="clone-関数-deep-copy">clone 関数 (deep copy)<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">clone-関数-deep-copy</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[Tree <- lrn("regr.rpart")

Tree1 <- Tree$clone()

lobstr::obj_addr(Tree)

lobstr::obj_addr(Tree1)
]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-annotation">
<dl>
<dt>Line 3</dt>
<dd>
deep-copy
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[[1] "0x14920a940"
[1] "0x149bf06f0"]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
</div>
<h2 id="method-chain">Method chain<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">method-chain</ac:parameter></ac:structured-macro></h2>
<ul>
<li><p>Object oriented programming</p>
<ul>
<li><p>objectにデータと関数(method) を格納</p></li>
<li><p>methodにより、object内データを操作</p></li>
<li><p>Rでは$で呼び出す</p></li>
</ul></li>
<li><p>Method chain: methodを$で繋げることで、逐次的な処理が可能</p>
<ul>
<li><p>慣れると、codeの読みやすさが改善</p></li>
<li><p>関数志向におけるpipe演算子に似た利点</p></li>
</ul></li>
</ul>
<h2 id="例">例<ac:structured-macro ac:name="anchor" ac:schema-version="1" ac:local-id="a6aa6f25-0bee-4a7f-929b-71fcb7eba592" ac:macro-id="d2cb5be1217ae6e086bc60005e9d27b7"><ac:parameter ac:name="">例</ac:parameter></ac:structured-macro></h2>
<div class="cell">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[library(tidyverse)]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-annotation">
<dl>
<dt>Line 6</dt>
<dd>
複製/推定ずみ決定木を保存
</dd>
</dl>
</div>
<div class="cell-output cell-output-stderr">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[Data <- read_csv("Public/Example.csv")]]>
        </ac:plain-text-body>
    </ac:structured-macro>
<div class="cell-output cell-output-stderr">
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language"></ac:parameter>
        <ac:plain-text-body>
          <![CDATA[Rows: 16786 Columns: 38
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (38): Price, Tenure, DistanceStation, Size, Youseki, Kenpei, RoomNum, Zo...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
<ac:structured-macro
      ac:name="code"
      ac:schema-version="1"
      ac:macro-id="1d1a2d13-0179-4d8f-b448-b28dfaceea4a">
        <ac:parameter ac:name="language">r</ac:parameter>
        <ac:plain-text-body>
          <![CDATA[Task <- as_task_regr(
  Data,
  "Price"
)

EstTree <- Tree$clone()$train(Task)$model
]]>
        </ac:plain-text-body>
    </ac:structured-macro>
</div>
